<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>MTAIIRUS App Store</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <style>
        :root{
            --primary:#6366f1; --primary-dark:#4f46e5; --primary-light:#818cf8;
            --secondary:#10b981; --danger:#ef4444; --warning:#f59e0b;
            --dark:#0f172a; --darker:#020617; --light:#f8fafc; --gray:#64748b;
            --glass-bg: rgba(255,255,255,0.05); --glass-border: rgba(255,255,255,0.1);
            --shadow: 0 8px 32px rgba(0,0,0,0.3);
            --space-sm: 0.5rem; --space-md: 1rem; --space-lg:1.5rem; --space-xl:2rem;
            --radius-md:0.75rem; --radius-lg:1rem;
        }
        *{box-sizing:border-box;margin:0;padding:0}
        body{
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg,var(--darker),var(--dark));
            color:var(--light); min-height:100vh; line-height:1.6;
        }
        .glass{ background:var(--glass-bg); backdrop-filter:blur(16px); border:1px solid var(--glass-border); border-radius:var(--radius-lg); box-shadow:var(--shadow);}
        .gradient-text{ background:linear-gradient(90deg,var(--primary),var(--primary-light)); -webkit-background-clip:text; background-clip:text; color:transparent; }
        .container{max-width:1200px;margin:0 auto;padding:0 var(--space-lg);}

        .btn{display:inline-flex;align-items:center;gap:0.5rem;padding:0.6rem 1rem;border-radius:0.75rem;border:none;cursor:pointer;font-weight:600;transition:all 0.2s}
        .btn-primary{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:white}
        .btn-secondary{background:linear-gradient(135deg,var(--secondary),#059669);color:white}
        .btn-danger{background:linear-gradient(135deg,var(--danger),#dc2626);color:white}
        .btn-sm{padding:0.35rem 0.6rem;font-size:0.8rem}

        .header{position:sticky;top:0;background:rgba(15,23,42,0.95);backdrop-filter:blur(12px);border-bottom:1px solid var(--glass-border);padding:0.8rem 0;z-index:100;}
        .header-content{display:flex;align-items:center;justify-content:space-between;gap:1rem}

        .logo{display:flex;align-items:center;gap:0.75rem;text-decoration:none;color:inherit}
        .logo-icon{width:2.5rem;height:2.5rem;background:linear-gradient(135deg,var(--primary),var(--primary-dark));border-radius:0.75rem;display:flex;align-items:center;justify-content:center}
        .logo-text{font-size:1.25rem;font-weight:700}

        .badge{display:inline-flex;align-items:center;gap:0.5rem;padding:0.25rem 0.6rem;border-radius:999px;font-weight:700}
        .badge-locked{background:rgba(239,68,68,0.08);color:var(--danger)}
        .badge-unlocked{background:rgba(16,185,129,0.08);color:var(--secondary)}

        .search-container{position:relative;max-width:36rem;margin:2rem auto}
        .search-bar{width:100%;padding:1rem 1.25rem 1rem 3.5rem;border-radius:1rem;background:var(--glass-bg);border:1px solid var(--glass-border);color:var(--light)}
        .search-icon{position:absolute;left:1.1rem;top:50%;transform:translateY(-50%);color:var(--gray)}

        .stats-bar{display:grid;grid-template-columns:repeat(auto-fit,minmax(10rem,1fr));gap:1rem;margin:1.5rem auto;max-width:48rem}
        .stat-card{padding:1rem;text-align:center}
        .stat-number{font-size:1.6rem;font-weight:800;color:var(--primary);display:block}

        .app-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(20rem,1fr));gap:1.25rem;margin:1.5rem 0}
        .app-card{position:relative;display:flex;flex-direction:column;overflow:hidden;border-radius:0.75rem;transition:transform 0.2s}
        .app-card:hover{transform:translateY(-6px)}
        .app-image{width:100%;height:12rem;object-fit:cover;border-bottom:1px solid var(--glass-border)}
        .app-content{padding:1rem;display:flex;flex-direction:column;gap:0.5rem}
        .app-header{display:flex;align-items:flex-start;gap:0.75rem}
        .app-icon{width:3rem;height:3rem;border-radius:0.75rem;background:linear-gradient(135deg,var(--primary),var(--primary-dark));display:flex;align-items:center;justify-content:center}
        .tag{background:rgba(99,102,241,0.08);color:var(--primary-light);padding:0.15rem 0.5rem;border-radius:999px;font-weight:600;font-size:0.75rem}

        .app-actions{display:flex;gap:0.5rem;margin-top:auto}
        .app-actions .btn{flex:1}

        .admin-controls{position:fixed;bottom:2rem;right:2rem;display:flex;flex-direction:column;gap:0.75rem;z-index:99}
        .admin-btn{width:3.5rem;height:3.5rem;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.2rem}

        .modal-overlay{position:fixed;inset:0;background:rgba(2,6,23,0.7);backdrop-filter:blur(6px);z-index:1000;display:none}
        .modal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:90%;max-width:48rem;max-height:90vh;overflow:auto;z-index:1001;padding:1rem;display:none}
        .modal-header{display:flex;align-items:center;justify-content:space-between;padding-bottom:0.6rem;border-bottom:1px solid var(--glass-border)}
        .modal-close{background:none;border:none;color:var(--gray);font-size:1.2rem;cursor:pointer}

        .form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(15rem,1fr));gap:0.75rem;margin-bottom:1rem}
        .form-label{font-weight:700;font-size:0.9rem;color:var(--gray);margin-bottom:0.25rem}
        .form-input,.form-select,.form-textarea{width:100%;padding:0.65rem;border-radius:0.6rem;background:var(--glass-bg);border:1px solid var(--glass-border);color:var(--light)}
        .form-textarea{min-height:6rem;resize:vertical}

        .toast{position:fixed;top:1rem;right:1rem;padding:0.6rem 1rem;background:var(--glass-bg);border:1px solid var(--glass-border);border-radius:0.6rem;display:flex;align-items:center;gap:0.6rem;z-index:1002;transform:translateX(120%);transition:transform 0.25s}
        .toast.show{transform:translateX(0)}
        .toast-success{border-left:4px solid var(--secondary)}
        .toast-error{border-left:4px solid var(--danger)}

        .empty-state{padding:1.5rem;text-align:center;color:var(--gray)}
        
        /* Lock Screen */
        .lock-screen-container {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--darker), var(--dark));
            z-index: 1000;
        }
        
        .lock-screen {
            width: 100%;
            max-width: 28rem;
            padding: 2rem;
            text-align: center;
        }
        
        .lock-icon {
            width: 5rem;
            height: 5rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
        }
        
        .lock-input {
            padding: 1rem;
            border-radius: 0.75rem;
            background: rgba(255,255,255,0.08);
            border: 2px solid var(--glass-border);
            color: var(--light);
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
            letter-spacing: 2px;
            width: 100%;
            margin-bottom: 1rem;
        }
        
        @media(max-width:768px){ 
            .app-grid{grid-template-columns:1fr} 
            .header-content{flex-direction:column;gap:0.6rem} 
            .admin-controls{bottom:1rem;right:1rem} 
        }
        
        @keyframes shake{
            0%,100%{transform:translateX(0)}
            10%,30%,50%,70%,90%{transform:translateX(-5px)}
            20%,40%,60%,80%{transform:translateX(5px)}
        }
    </style>
</head>
<body>
    <!-- Lock Screen -->
    <div id="lockScreen" class="lock-screen-container">
        <div class="glass lock-screen">
            <div class="lock-icon">
                <i class="fas fa-lock" style="color:white;font-size:2rem"></i>
            </div>
            <h1 class="gradient-text" style="font-size:2.5rem;margin-bottom:0.5rem">MTAIIRUS</h1>
            <p style="color:var(--gray);margin-bottom:1.5rem">Enter password to access the application store</p>
            <div style="display:flex;flex-direction:column;gap:0.75rem">
                <input id="lockPassword" type="password" class="lock-input" placeholder="Enter password" maxlength="40" autofocus>
                <button class="btn btn-primary" onclick="unlockAppStore()" style="padding:1rem;font-size:1.1rem">
                    <i class="fas fa-unlock"></i><span>Unlock App Store</span>
                </button>
                <div id="lockError" style="color:var(--danger);display:none;margin-top:0.5rem">
                    <i class="fas fa-exclamation-circle"></i> Incorrect password. Try: <strong>mtaiirus</strong>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" style="display:none;">
        <header class="header">
            <div class="container header-content">
                <div class="logo">
                    <div class="logo-icon"><i class="fas fa-store" style="color:white"></i></div>
                    <span class="logo-text gradient-text">MTAIIRUS</span>
                </div>
                <div style="display:flex;align-items:center;gap:0.75rem;">
                    <div class="badge badge-unlocked">
                        <i class="fas fa-shield-alt"></i><span>Unlocked</span>
                    </div>
                    <button class="btn btn-sm btn-danger" onclick="lockApp()">
                        <i class="fas fa-lock"></i><span> Lock</span>
                    </button>
                </div>
            </div>
        </header>

        <main class="container">
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input id="searchBar" class="search-bar" type="text" placeholder="Search applications...">
            </div>

            <div class="stats-bar">
                <div class="stat-card glass"><span id="totalApps" class="stat-number">0</span><span class="stat-label">Total Apps</span></div>
                <div class="stat-card glass"><span id="featuredApps" class="stat-number">0</span><span class="stat-label">Featured</span></div>
                <div class="stat-card glass"><span id="lockedApps" class="stat-number">0</span><span class="stat-label">Locked</span></div>
                <div class="stat-card glass"><span id="categories" class="stat-number">0</span><span class="stat-label">Categories</span></div>
            </div>

            <section>
                <div class="section-header" style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem">
                    <div style="display:flex;align-items:center;gap:0.75rem">
                        <div class="logo-icon"><i class="fas fa-th-large" style="color:white"></i></div>
                        <h2 style="font-size:1.1rem">All Applications</h2>
                    </div>
                    <button class="btn btn-primary btn-sm" onclick="openAdminPanel()">
                        <i class="fas fa-plus"></i><span> Add App</span>
                    </button>
                </div>

                <div id="appGrid" class="app-grid">
                    <!-- Apps will be loaded here -->
                </div>
            </section>
        </main>

        <!-- Add App Button -->
        <div class="admin-controls">
            <button class="btn btn-primary admin-btn" onclick="openAdminPanel()" title="Add Application">
                <i class="fas fa-plus"></i>
            </button>
        </div>
    </div>

    <!-- Admin Modal -->
    <div id="adminModal" class="modal glass" style="display:none;">
        <div class="modal-header">
            <h3 style="display:flex;align-items:center;gap:0.5rem">
                <i class="fas fa-plus-circle"></i> <span id="modalTitle">Add New Application</span>
            </h3>
            <button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
        </div>

        <div class="modal-body">
            <form id="appForm">
                <input type="hidden" id="appId" value="">
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Application Name *</label>
                        <input id="appName" class="form-input" type="text" placeholder="Enter app name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Icon</label>
                        <select id="appIcon" class="form-select">
                            <option value="fas fa-box">Default</option>
                            <option value="fas fa-gamepad">Game</option>
                            <option value="fas fa-tools">Tool</option>
                            <option value="fas fa-graduation-cap">Education</option>
                            <option value="fas fa-music">Music</option>
                            <option value="fas fa-video">Video</option>
                            <option value="fas fa-code">Code</option>
                            <option value="fas fa-chart-bar">Analytics</option>
                            <option value="fas fa-calculator">Calculator</option>
                            <option value="fas fa-calendar">Calendar</option>
                            <option value="fas fa-file-alt">Document</option>
                        </select>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Categories</label>
                        <input id="appCategories" class="form-input" type="text" placeholder="Tools, Productivity, Games">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Rating (1-5)</label>
                        <select id="appRating" class="form-select">
                            <option value="1">‚≠ê (1)</option>
                            <option value="2">‚≠ê‚≠ê (2)</option>
                            <option value="3" selected>‚≠ê‚≠ê‚≠ê (3)</option>
                            <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê (4)</option>
                            <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5)</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea id="appDescription" class="form-textarea" placeholder="Enter app description..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">HTML Content *</label>
                    <textarea id="appHtmlContent" class="form-textarea" placeholder="Paste your HTML code here..." required style="min-height: 200px; font-family: monospace; font-size: 0.9rem;"></textarea>
                </div>

                <div class="form-grid" style="align-items:center">
                    <div style="display:flex;align-items:center;gap:0.5rem">
                        <input id="isLocked" type="checkbox">
                        <label for="isLocked" class="form-label" style="margin:0">Lock application</label>
                    </div>
                    <div style="display:flex;align-items:center;gap:0.5rem">
                        <input id="isFeatured" type="checkbox">
                        <label for="isFeatured" class="form-label" style="margin:0">Mark as featured</label>
                    </div>
                </div>
            </form>

            <div style="margin-top:1.5rem">
                <h4 style="margin-bottom:0.75rem">Quick HTML Templates:</h4>
                <div style="display:flex;gap:0.5rem;flex-wrap:wrap">
                    <button type="button" class="btn btn-sm" onclick="loadTemplate('calculator')">Calculator</button>
                    <button type="button" class="btn btn-sm" onclick="loadTemplate('todo')">Todo List</button>
                    <button type="button" class="btn btn-sm" onclick="loadTemplate('notes')">Notes App</button>
                    <button type="button" class="btn btn-sm" onclick="loadTemplate('timer')">Timer</button>
                </div>
            </div>
        </div>

        <div class="modal-footer" style="display:flex;gap:0.5rem;justify-content:flex-end;padding-top:0.6rem;border-top:1px solid var(--glass-border)">
            <button class="btn" onclick="closeModal()">Cancel</button>
            <button id="deleteBtn" class="btn btn-danger" onclick="deleteApplication()" style="display:none">
                <i class="fas fa-trash"></i> Delete
            </button>
            <button class="btn btn-primary" onclick="saveApplication()" id="saveBtn">
                <i class="fas fa-plus"></i> Add Application
            </button>
        </div>
    </div>

    <!-- Modal Overlay -->
    <div id="modalOverlay" class="modal-overlay" onclick="closeModal()"></div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">Operation completed</span>
    </div>

    <script>
        // Your Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA8Ck4k7gMfn9oU1nq-JBijML1JE6yVx84",
            authDomain: "project45-627cc.firebaseapp.com",
            databaseURL: "https://project45-627cc-default-rtdb.firebaseio.com",
            projectId: "project45-627cc",
            storageBucket: "project45-627cc.firebasestorage.app",
            messagingSenderId: "850515567224",
            appId: "1:850515567224:web:bcbed252ee8596c08fc38d"
        };

        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            console.log("Firebase initialized successfully");
        } catch (error) {
            console.log("Firebase already initialized or error:", error);
        }

        // Get Firebase services
        const auth = firebase.auth();
        const database = firebase.database();
        const storage = firebase.storage();

        // Simple Password Lock (for quick access)
        const APP_PASSWORD = "mtaiirus";
        let isUnlocked = false;
        let applications = [];

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('App initialized');
            
            // Setup Enter key for unlock
            document.getElementById('lockPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    unlockAppStore();
                }
            });
            
            // Setup search
            document.getElementById('searchBar').addEventListener('input', function() {
                renderApplications();
            });
            
            // Focus on password field
            document.getElementById('lockPassword').focus();
            
            // Try to load from Firebase
            loadAppsFromFirebase();
        });

        // Lock/Unlock Functions
        function unlockAppStore() {
            const password = document.getElementById('lockPassword').value;
            const errorDiv = document.getElementById('lockError');
            
            console.log('Password entered:', password);
            
            if (password === APP_PASSWORD) {
                // Correct password
                document.getElementById('lockScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                errorDiv.style.display = 'none';
                document.getElementById('lockPassword').value = '';
                isUnlocked = true;
                showToast('Welcome to MTAIIRUS App Store!');
                
                // Load apps
                loadAppsFromFirebase();
            } else {
                // Wrong password
                errorDiv.style.display = 'block';
                document.getElementById('lockPassword').value = '';
                document.getElementById('lockPassword').focus();
                
                // Shake animation
                const lockScreen = document.querySelector('.lock-screen');
                lockScreen.style.animation = 'shake 0.5s';
                setTimeout(function() {
                    lockScreen.style.animation = '';
                }, 500);
            }
        }

        function lockApp() {
            if (confirm('Lock the app store?')) {
                document.getElementById('lockScreen').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('lockPassword').value = '';
                document.getElementById('lockPassword').focus();
                document.getElementById('lockError').style.display = 'none';
                isUnlocked = false;
                showToast('App Store locked');
            }
        }

        // Firebase Functions
        function loadAppsFromFirebase() {
            if (!isUnlocked) return;
            
            database.ref('apps').once('value').then(function(snapshot) {
                applications = [];
                snapshot.forEach(function(childSnapshot) {
                    const app = childSnapshot.val();
                    app.id = childSnapshot.key;
                    applications.push(app);
                });
                
                // If no apps in Firebase, load sample apps
                if (applications.length === 0) {
                    loadSampleApps();
                } else {
                    renderApplications();
                    updateStats();
                }
            }).catch(function(error) {
                console.log('Error loading from Firebase:', error);
                // Fallback to local storage
                loadAppsFromLocalStorage();
            });
        }

        function saveAppToFirebase(appData, isEditing = false) {
            if (!isUnlocked) return;
            
            try {
                if (isEditing && appData.id) {
                    // Update existing app
                    database.ref('apps/' + appData.id).update(appData)
                        .then(function() {
                            showToast('App updated in Firebase!');
                            loadAppsFromFirebase();
                        })
                        .catch(function(error) {
                            console.error('Error updating app:', error);
                            saveAppToLocalStorage(appData, isEditing);
                        });
                } else {
                    // Create new app
                    const newAppRef = database.ref('apps').push();
                    appData.id = newAppRef.key;
                    newAppRef.set(appData)
                        .then(function() {
                            showToast('App saved to Firebase!');
                            loadAppsFromFirebase();
                        })
                        .catch(function(error) {
                            console.error('Error saving app:', error);
                            saveAppToLocalStorage(appData, isEditing);
                        });
                }
            } catch (error) {
                console.log('Firebase error, saving locally:', error);
                saveAppToLocalStorage(appData, isEditing);
            }
        }

        function deleteAppFromFirebase(appId) {
            if (!isUnlocked) return;
            
            database.ref('apps/' + appId).remove()
                .then(function() {
                    showToast('App deleted from Firebase!');
                    loadAppsFromFirebase();
                })
                .catch(function(error) {
                    console.error('Error deleting app:', error);
                    deleteAppFromLocalStorage(appId);
                });
        }

        // Local Storage Fallback
        function loadAppsFromLocalStorage() {
            try {
                const saved = localStorage.getItem('mtaiirus_apps');
                if (saved) {
                    applications = JSON.parse(saved) || [];
                }
                
                if (applications.length === 0) {
                    loadSampleApps();
                } else {
                    renderApplications();
                    updateStats();
                }
            } catch (e) {
                console.error('Error loading from localStorage:', e);
                loadSampleApps();
            }
        }

        function saveAppToLocalStorage(appData, isEditing = false) {
            try {
                if (isEditing && appData.id) {
                    const index = applications.findIndex(function(a) {
                        return a.id === appData.id;
                    });
                    if (index !== -1) {
                        applications[index] = appData;
                    }
                } else {
                    appData.id = 'local_' + Date.now();
                    applications.push(appData);
                }
                
                localStorage.setItem('mtaiirus_apps', JSON.stringify(applications));
                renderApplications();
                updateStats();
                showToast('App saved locally!');
            } catch (e) {
                console.error('Error saving to localStorage:', e);
                showToast('Error saving app!', true);
            }
        }

        function deleteAppFromLocalStorage(appId) {
            applications = applications.filter(function(a) {
                return a.id !== appId;
            });
            localStorage.setItem('mtaiirus_apps', JSON.stringify(applications));
            renderApplications();
            updateStats();
            showToast('App deleted locally!');
        }

        // Sample Apps
        function loadSampleApps() {
            applications = [
                {
                    id: 'sample_1',
                    name: "Calculator Pro",
                    icon: "fas fa-calculator",
                    categories: ["Tools", "Productivity"],
                    description: "Advanced calculator with scientific functions",
                    rating: 4,
                    isLocked: false,
                    isFeatured: true,
                    htmlContent: `<!DOCTYPE html><html><head><title>Calculator</title><style>body{font-family:Arial;margin:0;padding:20px;background:#f0f0f0;}.calculator{max-width:300px;margin:0 auto;background:white;padding:20px;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,0.1);}.display{padding:20px;font-size:24px;text-align:right;background:#333;color:white;border-radius:5px;margin-bottom:10px;}.buttons{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;}button{padding:20px;font-size:18px;border:none;border-radius:5px;cursor:pointer;background:#e0e0e0;}button:hover{background:#d0d0d0;}.equals{background:#4CAF50;color:white;}.clear{background:#f44336;color:white;}</style></head><body><div class="calculator"><div class="display" id="display">0</div><div class="buttons"><button class="clear" onclick="clearDisplay()">C</button><button onclick="append('/')">/</button><button onclick="append('*')">√ó</button><button onclick="append('-')">-</button><button onclick="append('7')">7</button><button onclick="append('8')">8</button><button onclick="append('9')">9</button><button onclick="append('+')">+</button><button onclick="append('4')">4</button><button onclick="append('5')">5</button><button onclick="append('6')">6</button><button onclick="append('1')">1</button><button onclick="append('2')">2</button><button onclick="append('3')">3</button><button class="equals" onclick="calculate()">=</button><button onclick="append('0')">0</button><button onclick="append('.')">.</button></div></div><script>let display=document.getElementById('display');let current='0';function append(value){if(current==='0'){current=value}else{current+=value}display.textContent=current}function clearDisplay(){current='0';display.textContent=current}function calculate(){try{current=eval(current).toString();display.textContent=current}catch(e){display.textContent='Error';current='0'}}<\/script></body></html>`,
                    downloads: 0,
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'sample_2',
                    name: "Todo List",
                    icon: "fas fa-tasks",
                    categories: ["Productivity", "Tools"],
                    description: "Manage your daily tasks efficiently",
                    rating: 5,
                    isLocked: false,
                    isFeatured: true,
                    htmlContent: `<!DOCTYPE html><html><head><title>Todo List</title><style>body{font-family:Arial;margin:0;padding:20px;background:#f0f0f0;}.container{max-width:500px;margin:0 auto;background:white;padding:30px;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,0.1);}h1{text-align:center;color:#333;}.input-group{display:flex;gap:10px;margin-bottom:20px;}input{flex:1;padding:10px;border:1px solid #ddd;border-radius:5px;}button{padding:10px 20px;background:#4CAF50;color:white;border:none;border-radius:5px;cursor:pointer;}.todo-item{display:flex;justify-content:space-between;align-items:center;padding:10px;background:#f9f9f9;margin-bottom:5px;border-radius:5px;}.delete{background:#f44336;color:white;padding:5px 10px;border:none;border-radius:3px;cursor:pointer;}</style></head><body><div class="container"><h1>üìù Todo List</h1><div class="input-group"><input type="text" id="todoInput" placeholder="Add a new task..."><button onclick="addTodo()">Add</button></div><div id="todoList"></div></div><script>function loadTodos(){let todos=JSON.parse(localStorage.getItem('todos')||'[]');let list=document.getElementById('todoList');list.innerHTML='';todos.forEach((todo,index)=>{let item=document.createElement('div');item.className='todo-item';item.innerHTML='<span>'+todo+'</span><button class="delete" onclick="deleteTodo('+index+')">Delete</button>';list.appendChild(item);});}function addTodo(){let input=document.getElementById('todoInput');let todo=input.value.trim();if(todo){let todos=JSON.parse(localStorage.getItem('todos')||'[]');todos.push(todo);localStorage.setItem('todos',JSON.stringify(todos));input.value='';loadTodos();}}function deleteTodo(index){let todos=JSON.parse(localStorage.getItem('todos')||'[]');todos.splice(index,1);localStorage.setItem('todos',JSON.stringify(todos));loadTodos();}loadTodos();document.getElementById('todoInput').addEventListener('keypress',(e)=>{if(e.key==='Enter')addTodo();});<\/script></body></html>`,
                    downloads: 0,
                    createdAt: new Date().toISOString()
                }
            ];
            
            // Save sample apps to Firebase first, then fallback to localStorage
            applications.forEach(function(app) {
                saveAppToFirebase(app);
            });
            
            renderApplications();
            updateStats();
        }

        // Render Applications
        function renderApplications() {
            const appGrid = document.getElementById('appGrid');
            const searchTerm = document.getElementById('searchBar').value.toLowerCase();
            
            let filteredApps = applications;
            if (searchTerm) {
                filteredApps = applications.filter(function(app) {
                    return app.name.toLowerCase().includes(searchTerm) ||
                           (app.description && app.description.toLowerCase().includes(searchTerm)) ||
                           (app.categories && app.categories.some(function(cat) {
                               return cat.toLowerCase().includes(searchTerm);
                           }));
                });
            }
            
            if (filteredApps.length === 0) {
                appGrid.innerHTML = '<div class="empty-state glass"><p>No applications found</p><button class="btn btn-primary" onclick="openAdminPanel()">Add Your First App</button></div>';
                return;
            }
            
            let html = '';
            filteredApps.forEach(function(app) {
                const categories = Array.isArray(app.categories) ? app.categories : [];
                const rating = app.rating || 3;
                
                html += `
                <div class="app-card glass">
                    ${app.isFeatured ? '<div class="badge" style="position:absolute;top:0.75rem;left:0.75rem;background:rgba(245,158,11,0.08);color:var(--warning)"><i class="fas fa-star"></i> Featured</div>' : ''}
                    ${app.isLocked ? '<div class="badge badge-locked" style="position:absolute;top:0.75rem;right:0.75rem;"><i class="fas fa-lock"></i> Locked</div>' : ''}
                    
                    <div class="app-image" style="background:linear-gradient(135deg,var(--primary-dark),var(--primary));display:flex;align-items:center;justify-content:center;color:white;font-size:3rem">
                        <i class="${app.icon || 'fas fa-box'}"></i>
                    </div>
                    
                    <div class="app-content">
                        <div class="app-header">
                            <div class="app-icon">
                                <i class="${app.icon || 'fas fa-box'}" style="color:white"></i>
                            </div>
                            <div style="flex:1">
                                <h3 style="margin:0;font-size:1rem">${escapeHtml(app.name)}</h3>
                                <small style="color:var(--gray)">${app.downloads || 0} downloads</small>
                            </div>
                        </div>
                        
                        <div style="display:flex;gap:0.4rem;flex-wrap:wrap">
                            ${categories.map(function(cat) {
                                return `<span class="tag">${escapeHtml(cat)}</span>`;
                            }).join('')}
                        </div>
                        
                        <div style="display:flex;align-items:center;gap:0.5rem;margin-top:0.5rem">
                            ${'‚≠ê'.repeat(rating)}${'‚òÜ'.repeat(5 - rating)}
                        </div>
                        
                        <p style="color:var(--gray);margin:0.6rem 0 0;font-size:0.9rem">
                            ${escapeHtml(app.description || 'No description')}
                        </p>
                        
                        <div class="app-actions">
                            <button class="btn btn-primary" ${app.isLocked ? 'disabled style="opacity:0.5"' : ''} onclick="runApp('${app.id}')">
                                <i class="fas fa-play"></i> ${app.isLocked ? 'Locked' : 'Run'}
                            </button>
                            <button class="btn btn-secondary" onclick="downloadApp('${app.id}')">
                                <i class="fas fa-download"></i> Download
                            </button>
                            <button class="btn btn-sm" onclick="editApp('${app.id}')" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </div>
                </div>
                `;
            });
            
            appGrid.innerHTML = html;
        }

        function updateStats() {
            document.getElementById('totalApps').textContent = applications.length;
            document.getElementById('featuredApps').textContent = applications.filter(function(a) {
                return a.isFeatured;
            }).length;
            document.getElementById('lockedApps').textContent = applications.filter(function(a) {
                return a.isLocked;
            }).length;
            
            const categories = new Set();
            applications.forEach(function(app) {
                if (Array.isArray(app.categories)) {
                    app.categories.forEach(function(cat) {
                        categories.add(cat);
                    });
                }
            });
            document.getElementById('categories').textContent = categories.size;
        }

        // App Actions
        function runApp(appId) {
            if (!isUnlocked) {
                showToast('Please unlock the app store first', true);
                return;
            }
            
            const app = applications.find(function(a) {
                return a.id === appId;
            });
            if (!app) {
                showToast('Application not found', true);
                return;
            }
            
            if (app.isLocked) {
                showToast('This application is locked', true);
                return;
            }
            
            try {
                const newWindow = window.open('', '_blank');
                if (newWindow) {
                    newWindow.document.write(app.htmlContent);
                    newWindow.document.close();
                    showToast('Running ' + app.name);
                    
                    // Update run count
                    app.downloads = (app.downloads || 0) + 1;
                    saveAppToFirebase(app, true);
                } else {
                    showToast('Please allow popups to run applications', true);
                }
            } catch (error) {
                console.error('Error running app:', error);
                showToast('Error running application', true);
            }
        }

        function downloadApp(appId) {
            if (!isUnlocked) {
                showToast('Please unlock the app store first', true);
                return;
            }
            
            const app = applications.find(function(a) {
                return a.id === appId;
            });
            if (!app) {
                showToast('Application not found', true);
                return;
            }
            
            try {
                const blob = new Blob([app.htmlContent], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = app.name.replace(/\s+/g, '_').toLowerCase() + '.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                // Update download count
                app.downloads = (app.downloads || 0) + 1;
                saveAppToFirebase(app, true);
                
                showToast(app.name + ' downloaded!');
            } catch (error) {
                console.error('Error downloading app:', error);
                showToast('Error downloading application', true);
            }
        }

        // Modal Functions
        function openAdminPanel() {
            if (!isUnlocked) {
                showToast('Please unlock the app store first', true);
                return;
            }
            
            document.getElementById('adminModal').style.display = 'block';
            document.getElementById('modalOverlay').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('adminModal').style.display = 'none';
            document.getElementById('modalOverlay').style.display = 'none';
            document.body.style.overflow = 'auto';
            clearForm();
        }

        function clearForm() {
            document.getElementById('appForm').reset();
            document.getElementById('appId').value = '';
            document.getElementById('modalTitle').textContent = 'Add New Application';
            document.getElementById('saveBtn').innerHTML = '<i class="fas fa-plus"></i> Add Application';
            document.getElementById('deleteBtn').style.display = 'none';
            document.getElementById('appRating').value = '3';
        }

        function editApp(appId) {
            if (!isUnlocked) {
                showToast('Please unlock the app store first', true);
                return;
            }
            
            const app = applications.find(function(a) {
                return a.id === appId;
            });
            if (!app) {
                showToast('Application not found', true);
                return;
            }
            
            document.getElementById('appId').value = app.id;
            document.getElementById('appName').value = app.name;
            document.getElementById('appIcon').value = app.icon || 'fas fa-box';
            document.getElementById('appCategories').value = Array.isArray(app.categories) ? app.categories.join(', ') : '';
            document.getElementById('appRating').value = app.rating || 3;
            document.getElementById('appDescription').value = app.description || '';
            document.getElementById('appHtmlContent').value = app.htmlContent || '';
            document.getElementById('isLocked').checked = app.isLocked || false;
            document.getElementById('isFeatured').checked = app.isFeatured || false;
            
            document.getElementById('modalTitle').textContent = 'Edit Application';
            document.getElementById('saveBtn').innerHTML = '<i class="fas fa-save"></i> Save Changes';
            document.getElementById('deleteBtn').style.display = 'block';
            
            openAdminPanel();
            showToast('Editing ' + app.name);
        }

        function saveApplication() {
            if (!isUnlocked) {
                showToast('Please unlock the app store first', true);
                return;
            }
            
            const appId = document.getElementById('appId').value;
            const isEditing = appId !== '';
            
            const appData = {
                name: document.getElementById('appName').value.trim(),
                icon: document.getElementById('appIcon').value,
                categories: document.getElementById('appCategories').value.split(',').map(function(c) {
                    return c.trim();
                }).filter(function(c) {
                    return c;
                }),
                rating: parseInt(document.getElementById('appRating').value) || 3,
                description: document.getElementById('appDescription').value,
                htmlContent: document.getElementById('appHtmlContent').value,
                isLocked: document.getElementById('isLocked').checked,
                isFeatured: document.getElementById('isFeatured').checked,
                downloads: 0,
                createdAt: new Date().toISOString()
            };
            
            if (!appData.name) {
                showToast('Please enter app name', true);
                return;
            }
            
            if (!appData.htmlContent) {
                showToast('Please add HTML content', true);
                return;
            }
            
            if (isEditing) {
                appData.id = appId;
                // Find existing app to preserve downloads
                const existingApp = applications.find(function(a) {
                    return a.id === appId;
                });
                if (existingApp) {
                    appData.downloads = existingApp.downloads || 0;
                    appData.createdAt = existingApp.createdAt;
                }
                saveAppToFirebase(appData, true);
            } else {
                saveAppToFirebase(appData, false);
            }
            
            closeModal();
            clearForm();
        }

        function deleteApplication() {
            if (!isUnlocked) {
                showToast('Please unlock the app store first', true);
                return;
            }
            
            const appId = document.getElementById('appId').value;
            if (appId && confirm('Are you sure you want to delete this application?')) {
                deleteAppFromFirebase(appId);
                closeModal();
            }
        }

        // Template Functions
        function loadTemplate(templateName) {
            const templates = {
               
            
            if (templates[templateName]) {
                document.getElementById('appHtmlContent').value = templates[templateName];
                showToast('Loaded ' + templateName + ' template');
            }
        }

        // Utility Functions
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            const messageEl = document.getElementById('toastMessage');
            
            messageEl.textContent = message;
            toast.className = 'toast ' + (isError ? 'toast-error' : 'toast-success');
            toast.classList.add('show');
            
            setTimeout(function() {
                toast.classList.remove('show');
            }, 3000);
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Make functions available globally
        window.unlockAppStore = unlockAppStore;
        window.lockApp = lockApp;
        window.runApp = runApp;
        window.downloadApp = downloadApp;
        window.editApp = editApp;
        window.openAdminPanel = openAdminPanel;
        window.closeModal = closeModal;
        window.saveApplication = saveApplication;
        window.deleteApplication = deleteApplication;
        window.loadTemplate = loadTemplate;
    </script>
</body>
</html>
